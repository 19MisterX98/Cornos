/*
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
# Project: Cornos
# File: Hologram
# Created by constantin at 14:38, Mär 18 2021
PLEASE READ THE COPYRIGHT NOTICE IN THE PROJECT ROOT, IF EXISTENT
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
*/
package me.constantindev.ccl.command;

import me.constantindev.ccl.Cornos;
import me.constantindev.ccl.etc.base.Command;
import me.constantindev.ccl.etc.helper.ClientHelper;
import net.minecraft.item.ItemStack;
import net.minecraft.item.Items;
import net.minecraft.nbt.*;
import net.minecraft.text.Text;
import net.minecraft.util.math.BlockPos;

public class Hologram extends Command {
    public Hologram() {
        super("Hologram","Creates a hologram where you stand",new String[]{"hologram","holo","hg","hlg"});
    }

    @Override
    public void onExecute(String[] args) {
        if (!Cornos.minecraft.player.isCreative()) {
            ClientHelper.sendChat("You need to be in creative");
            return;
        }
        if (args.length < 1) {
            ClientHelper.sendChat("Please provide the text to display as arg");
            return;
        }
        ItemStack is = new ItemStack(Items.ARMOR_STAND);
        CompoundTag ct = is.getOrCreateTag();
        ByteTag vulnerable = ByteTag.ONE;
        ByteTag visible = ByteTag.ONE;
        ByteTag nogravity = ByteTag.ONE;
        ByteTag showName = ByteTag.ONE;
        String name = String.join(" ",args).replaceAll("&","§");
        BlockPos bp = Cornos.minecraft.player.getBlockPos();
        ListTag lt1 = new ListTag();
        lt1.add(DoubleTag.of(bp.getX()));
        lt1.add(DoubleTag.of(bp.getY()));
        lt1.add(DoubleTag.of(bp.getZ()));
        CompoundTag compoundTag = new CompoundTag();
        compoundTag.put("Pos",lt1);
        compoundTag.put("CustomName",StringTag.of("{\"text\":\""+name+"\"}"));
        compoundTag.put("CustomNameVisible", showName);
        compoundTag.put("Invisible",visible);
        compoundTag.put("Invulnerable",vulnerable);
        compoundTag.put("NoGravity",nogravity);
        ct.put("EntityTag", compoundTag);
        is.setCustomName(Text.of("§r§cHologram §4generated by §lCornos"));
        is.setTag(ct);
        Cornos.minecraft.player.inventory.addPickBlock(is);

        super.onExecute(args);
    }
}
